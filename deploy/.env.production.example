# ==============================
# cliproxy-access-manager (prod)
# ==============================
# Copy to .env and fill required values.
#
# Required values:
# - CLIPROXY_MGMT_BASE_URL
# - CLIPROXY_MGMT_KEY
# - APIM_HTTP_AUTH_TOKEN
#
# Telegram is optional. Keep TELEGRAM_BOT_TOKEN empty to disable bot.

# Upstream cliproxy management endpoint
CLIPROXY_MGMT_BASE_URL=http://127.0.0.1:8317
CLIPROXY_MGMT_KEY=CHANGE_ME_CLIPROXY_MANAGEMENT_KEY

# Image used by docker-compose.deploy.yml
APIM_IMAGE=moocher4097/cliproxy-access-manager:latest

# Sidecar HTTP API bind
APIM_HTTP_ADDR=0.0.0.0:8390

# Protect sidecar HTTP API (required in production)
APIM_HTTP_AUTH_TOKEN=CHANGE_ME_LONG_RANDOM_TOKEN

# Session/cookie auth (Web UI)
APIM_AUTH_SESSION_TTL=24h
APIM_AUTH_COOKIE_NAME=apim_session
APIM_AUTH_COOKIE_SECURE=true

# Optional admin bootstrap account (email/password login)
APIM_ADMIN_EMAIL=
APIM_ADMIN_PASSWORD=

# Persistence
APIM_DATA_DIR=/data
APIM_DB_PATH=/data/apim.db

# Sync intervals
APIM_KEY_SYNC_INTERVAL=30s
APIM_USAGE_SYNC_INTERVAL=2m
APIM_RECOVERY_CHECK_INTERVAL=60s

# Main project update tracking/control
# Daily check time in UTC (HH:MM). 04:00 means 04:00 UTC daily.
APIM_UPDATE_CHECK_ENABLED=true
APIM_UPDATE_CHECK_TIME=04:00
# Current CLIProxyAPI version is read automatically from management response headers (X-CPA-VERSION).
# Management endpoint for latest version query.
APIM_MANAGEMENT_LATEST_VERSION_URL=/v0/management/latest-version
# Apply configuration:
# - APIM_UPDATE_AUTO_APPLY_ENABLED=true enables unattended apply after check detects latest>current.
# - APIM_UPDATE_APPLY_COMMAND can override with custom command (disabled unless APIM_UPDATE_ALLOW_CUSTOM_COMMAND=true).
APIM_UPDATE_APPLY_COMMAND=
APIM_UPDATE_ALLOW_CUSTOM_COMMAND=false
APIM_UPDATE_AUTO_APPLY_ENABLED=false
APIM_AUTO_UPDATE_ENABLED=true
APIM_AUTO_UPDATE_SERVICE=cliproxy
APIM_AUTO_UPDATE_COMPOSE_FILE=
APIM_AUTO_UPDATE_WORKING_DIR=

# Security hardening for update endpoints
APIM_HTTP_UPDATE_REQUIRE_AUTH=true

# Recovery hardening
APIM_DB_RECOVER_ON_CORRUPT=true
APIM_RECOVERY_SNAPSHOT_SCAN_LIMIT=10

# TLS behavior for cliproxy management endpoint
APIM_INSECURE_SKIP_TLS_VERIFY=false

# Optional log level (reserved)
APIM_LOG_LEVEL=info

# Telegram bot (optional)
TELEGRAM_BOT_TOKEN=
TELEGRAM_ALLOWED_CHAT_IDS=
TELEGRAM_ALLOWED_USER_IDS=
TELEGRAM_POLL_INTERVAL=3s
APIM_TELEGRAM_DENY_HIGH_RISK_WHEN_ALLOWLIST_EMPTY=true

# Runtime proxy (optional)
HTTP_PROXY=
HTTPS_PROXY=
ALL_PROXY=
NO_PROXY=127.0.0.1,localhost,host.docker.internal

# Build-time Go module proxy (optional)
GOLANG_PROXY=https://proxy.golang.org,direct
